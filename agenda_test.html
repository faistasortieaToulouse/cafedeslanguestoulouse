<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Language" content="fr">
  <title>Bilingue - Agenda Dynamique</title>
  <style type="text/css">
    .suit { FONT-WEIGHT: bold; COLOR: white; BACKGROUND-COLOR: red }
    .green1 { FONT-WEIGHT: bold; COLOR: red; text-decoration: none; }
    .oui1 { FONT-WEIGHT: bold; COLOR: green; text-decoration: none; }
    .blanc { BACKGROUND-COLOR: #ffffff; FONT-SIZE: medium; font-family: Arial; padding: 5px; }
    .event-line { font-family: Arial; font-size: 12px; margin-bottom: 5px; text-align: left; border-bottom: 1px dotted #ccc; padding: 4px 0; }
    .date-badge { font-weight: bold; color: #1a365d; }
    .report-note { color: #c05621; font-style: italic; font-size: 11px; }
    .nav-button { background: #15315d; color: white; border: none; padding: 5px 15px; cursor: pointer; border-radius: 4px; font-weight: bold; }
    .nav-button:hover { background: #2d4a7c; }
  </style>
</head>

<body style="background-color: rgb(204, 255, 255);">

<table style="text-align: center; vertical-align: text-top; width: 100%;" border="0">
  <tbody>
    <tr>
      <td height="126" colspan="5">
        <img src="bilingue1.jpg" border="0" height="126" width="371" alt="Bilingue">
      </td>
    </tr>

    <tr>
      <td style="vertical-align: top; width: 150px;">
        <div class="blanc">
          <a class="green1" onmouseover="this.className='oui1'" onmouseout="this.className='green1'" href="lieux.htm">Lieux</a><br><br>
          <a class="green1" onmouseover="this.className='oui1'" onmouseout="this.className='green1'" href="active.htm">Activités</a>
        </div>
        <br>
        <img src="0London.jpg" border="0" height="200" width="130">
      </td>

      <td width="10"></td>

      <td style="vertical-align: top; width: 500px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
        
        <p style="text-align: center;">
            <button class="nav-button" onclick="changeMonth(-1)"> &lt; Précédent </button>
            <button class="nav-button" onclick="resetToToday()"> Aujourd'hui </button>
            <button class="nav-button" onclick="changeMonth(1)"> Suivant &gt; </button>
        </p>

        <p style="text-align: center;">
            <font color="#0000ff">
                <big style="font-family: Arial Black; text-decoration: underline; color: rgb(153, 51, 0); font-style: italic;">
                    <big id="current-month-display">Chargement...</big>
                </big>
            </font>
        </p>

        <div id="events-container">
            </div>
      </td>

      <td width="10"></td>

      <td style="vertical-align: top; width: 150px;">
        <div class="blanc">
          <a class="green1" onmouseover="this.className='oui1'" onmouseout="this.className='green1'" href="bilingue.htm">Accueil</a><br><br>
          <a class="green1" onmouseover="this.className='oui1'" onmouseout="this.className='green1'" href="present.htm">Présentation</a>
        </div>
        <br>
        <img src="0Sanmarino.jpg" border="0" height="200" width="125">
      </td>
    </tr>
  </tbody>
</table>

<script>
    // DEFI RELEVÉ : On initialise avec la date du jour réelle
    let viewDate = new Date(); 

    function formatLocal(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    function getHolidays(year) {
        const a = year % 19, b = Math.floor(year / 100), c = year % 100;
        const d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3);
        const h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4;
        const l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451);
        const month = Math.floor((h + l - 7 * m + 114) / 31), day = ((h + l - 7 * m + 114) % 31) + 1;
        const easter = new Date(year, month - 1, day);
        const add = (n) => { let r = new Date(easter); r.setDate(r.getDate() + n); return formatLocal(r); };
        
        return {
            [`${year}-01-01`]: "Jour de l'An", [`${year}-05-01`]: "Fête du Travail", [`${year}-05-08`]: "Victoire 45",
            [`${year}-07-14`]: "Fête Nationale", [`${year}-08-15`]: "Assomption", [`${year}-11-01`]: "Toussaint",
            [`${year}-11-11`]: "Armistice", [`${year}-12-25`]: "Noël", [add(1)]: "Lundi de Pâques", 
            [add(39)]: "Ascension", [add(50)]: "Lundi de Pentecôte"
        };
    }

    const DESC_MARDI = "anglais, espagnol, italien, portugais, allemand, russe, chinois, japonais, coréen, turc, polonais, roumain, néerlandais, suédois, serbo-croate, hongrois, bulgare, grec, finnois, tchèque, occitan, esperanto, langue des signes LSF, accueil des nouveaux toulousains et étrangers, français pour les étrangers";

    function renderAgenda() {
        const container = document.getElementById('events-container');
        const monthDisplay = document.getElementById('current-month-display');
        const year = viewDate.getFullYear();
        const month = viewDate.getMonth();
        const holidays = getHolidays(year);
        
        const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
        monthDisplay.innerText = monthNames[month] + " " + year;
        
        container.innerHTML = "";
        let d = new Date(year, month, 1);

        while (d.getMonth() === month) {
            let dayOfWeek = d.getDay();
            let dateStr = d.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'numeric', year: 'numeric' });
            let content = "";
            let note = "";

            if (dayOfWeek === 2) { // Mardi
                let session = new Date(d);
                if (holidays[formatLocal(session)]) {
                    let originFerie = holidays[formatLocal(session)];
                    session.setDate(session.getDate() + 1);
                    let newDateTxt = session.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'numeric', year: 'numeric' });
                    content = `<span class="date-badge">${newDateTxt.charAt(0).toUpperCase() + newDateTxt.slice(1)}</span> : ${DESC_MARDI}`;
                    note = `<br><span class="report-note">Reporté car le mardi était le ${originFerie}</span>`;
                } else {
                    content = `<span class="date-badge">${dateStr.charAt(0).toUpperCase() + dateStr.slice(1)}</span> : ${DESC_MARDI}`;
                }
            }
            else if (dayOfWeek === 4) content = `<span class="date-badge">${dateStr}</span> : Soirée linguistique et accueil des nouveaux`;
            else if (dayOfWeek === 5) content = `<span class="date-badge">${dateStr}</span> : Soirée cinéma Film en VO / ERASMUS`;
            else if (dayOfWeek === 6) content = `<span class="date-badge">${dateStr}</span> : Soirée Internationale et Quiz`;
            else if (dayOfWeek === 3 && d.getDate() > 20) content = `<span class="date-badge">${dateStr}</span> : Soirée jeu linguistique et New Amigos`;

            if (content !== "") {
                const div = document.createElement('div');
                div.className = "event-line";
                div.innerHTML = content + note;
                container.appendChild(div);
            }
            d.setDate(d.getDate() + 1);
        }
    }

    function changeMonth(dir) {
        viewDate.setMonth(viewDate.getMonth() + dir);
        renderAgenda();
    }

    function resetToToday() {
        viewDate = new Date();
        renderAgenda();
    }

    renderAgenda();
</script>

</body>
</html>